---
title: "FCSC 2021 - Guessy"
subtitle: "You'll probably need a lot of luck to guess the flag. Or some reverse engineering skills."
excerpt: "You'll probably need a lot of luck to guess the flag. Or some reverse engineering skills."
date: 2024-01-07
categories: [rev]
tags: [asm, x64, radare2]
ctfs: [fcsc]
author_profile: true
sidebar:
  nav: "docs"
header:
  overlay_color: "#000"
---

# Recon

The file is a non-stripped ELF executable :

```
$ file guessy
guessy: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, not stripped
```

It prompts the flag to the user :

```
~# ./guessy
Give me the flag:
flag
Well it does not begin well for you.
```

# Static analysis (using Radare2)

Let's look at the `main` function :

![1](/assets/img/guessy/1.png)

A user input is passed to the `validate` function : 

![2](/assets/img/guessy/2.png)

It seems to only compare the first 5 characters of the user input :

| Decimal | ASCII symbol |
|---|---|
| 70 | F |
| 67 | C |
| 83 | S |
| 67 | C |
| 123 | { |

And then, the control flow goes to the `difficult_part` function : 

![3](/assets/img/guessy/3.png)

#### Characters 6-13

Same as before, the awaited characters are not obfuscated : 

| Decimal | ASCII symbol |
|---|---|
| 101 | e |
| 55 | 7 |
| 53 | 5 |
| 53 | 5 |
| 50 | 2 |
| 99 | c |
| 102 | f |
| 54 | 6 |

> `FCSC{e7552cf6`

#### Characters 14-21

![4](/assets/img/guessy/4.png)

Before each comparison, the value of the register which contains the user-input characters is multiplied by two : `add eax, eax`. This way, to get the real characters, we just have to divide the awaited values by two : 

| Decimal | ASCII symbol |
|---|---|
| 52 | 4 |
| 55 | c |
| 101 | e |
| 50 | 2 |
| 101 | e |
| 53 | 5 |
| 102 | a |
| 100 | d |

> `FCSC{e7552cf64ce2e5ad`

#### Characters 22-29

![5](/assets/img/guessy/5.png)

This time, a 3-bits shift is made before doing the comparison : `shl eax, 3`. We just have to divide the awaited values by 8 (2^3) : 

| Shifted value | Awaited value | ASCII symbol
|----------------|-----------------|-----|
| 384 | 48 | 0
| 784 | 98 | b
| 784 | 98 | b
| 384 | 48 | 0
| 456 | 57 | 9
| 424 | 53 | 5
| 416 | 52 | 4
| 816 | 102 | f

> `FCSC{e7552cf64ce2e5ad0bb0954f`

#### Characters 30-37

![6](/assets/img/guessy/6.png)

Now, the previous 8 characters are xored with the following 8 characters and compared to the static characters. However, `a ^ b = c <=> a ^ c = b`, this way we can retrieve the awaited values : 

```python
previous = b"0bb0954f"
expected = b"\x01\x54\x55\x51\x09\x07\x57"
res = bytes([x^y for x,y in zip(previous, expected)])
```
Which returns `b'167a02cf'`, this way we have :

> `FCSC{e7552cf64ce2e5ad0bb0954f167a02cf`

#### Character 38

Then, a call to the `most_difficult_part` function is made :

![7](/assets/img/guessy/7.png)

The function only waits for the closing bracket : `}`. We now have the complete flag : 

> `FCSC{e7552cf64ce2e5ad0bb0954f167a02cf}`

```
# ./guessy
Give me the flag:
FCSC{
Ok so I see we have an understanding. Let's begin the difficult part now.
Now you can try to guess the next eight characters of the flag.
e7552cf6
Well done, you can try to guess the next eight characters but it won't be so easy.
4ce2e5ad
I see you've got some skills in reversing, but can you guess the next eight ?
0bb0954f
I must say that I'm impressed but it's not over. Will you be able to guess the next eight characters ?
167a02cf
Alright, now let's go to the most difficult part of this challenge.
Can you guess the LAST character of the flag ?
} 
Congratulations, you've guessed the flag !
```
