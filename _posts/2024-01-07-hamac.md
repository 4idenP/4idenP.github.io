---
title: "FCSC 2022 - Hamac"
subtitle: "Do you know rockyou ?"
excerpt: "Do you know rockyou ?"
date: 2024-01-07
categories: [crypto]
tags: [aes, sha256]
ctfs: [fcsc]
author_profile: true
sidebar:
  nav: "docs"
header:
  overlay_color: "#000"
---

# Investigations

We are given two fils for this challenge :

`hamac.py`
```python 
# python3 -m pip install pycryptodome
import json
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
from Crypto.Hash import HMAC, SHA256
from Crypto.Random import get_random_bytes

print("Enter your password")
password = input(">>> ").encode()
h = HMAC.new(password, digestmod = SHA256)
h.update(b"FCSC2022")

iv = get_random_bytes(16)
k  = SHA256.new(password).digest()
c  = AES.new(k, AES.MODE_CBC, iv = iv).encrypt(pad(open("flag.txt", "rb").read(), 16))
r = {
        "iv": iv.hex(),
        "c": c.hex(),
        "h": h.hexdigest(),
}
open("output.txt", "w").write(json.dumps(r))
```
`output.txt`
```json
{"iv": "ea425b2ea4bb67445abe967e3bd1b583", "c": "69771c85e2362a35eb0157497e9e2d17858bf11492e003c4aa8ce1b76d8d3a31ccc3412ec6e619e7996190d8693299fc3873e1e6a96bcc1fe67abdf5175c753c09128fd1eb2f2f15bd07b12c5bfc2933", "h": "951bd9d2caae0d9e9a5665b4fc112809aac9f5f9ecbcfc5ad8e23cb1d020201d"}
```

The `hamac.py` script has generated the `output.txt` file using an unknown password.

Here are the elements of `output.txt` : 

- iv : 16-bytes initialization vector
- c : ciphertext encrypted using the key **k**
- h : HMAC-SHA256 encrypted hash

In the description of the challenge, it is strongly indicated that `rockyou`, the famous wordlist, will be the key for this challenge.

By looking at the code, we can see the encrypted message is `FCSC2022` and it is encrypted using the secret password.

```python
print("Enter your password")
password = input(">>> ").encode()
h = HMAC.new(password, digestmod = SHA256)
h.update(b"FCSC2022")
```

# Password cracking

Using `hashcat` and `rockyou` as the wordlist, we crack the hash :

```bash
hashcat -m 1450 -a 0 "951bd9d2caae0d9e9a5665b4fc112809aac9f5f9ecbcfc5ad8e23cb1d020201d:FCSC2022" rockyou.txt
```
Les paramÃ¨tres sont les suivants : 

- `-m 1450` : HMAC-SHA256 mode
- `-a 0` : wordlist mode
- `"951bd9d2caae0d9e9a5665b4fc112809aac9f5f9ecbcfc5ad8e23cb1d020201d:FCSC2022` : hash followed by the plaintext
- `rockyou.txt` : the wordlist

![1](/assets/img/hamac/1.png)

> `omgh4xx0r`

# AES decryption

Using `pycryptodome`, lets decrypt the ciphertext by hashing the password using SHA-256, and then decrypting the ciphertext using the provided initialization vector :

```python
from Crypto.Cipher import AES
from Crypto.Hash import SHA256
from Crypto.Util.Padding import unpad

iv = bytes.fromhex("ea425b2ea4bb67445abe967e3bd1b583")
hash = bytes.fromhex("69771c85e2362a35eb0157497e9e2d17858bf11492e003c4aa8ce1b76d8d3a31ccc3412ec6e619e7996190d8693299fc3873e1e6a96bcc1fe67abdf5175c753c09128fd1eb2f2f15bd07b12c5bfc2933")
password = "omgh4xx0r"

key = SHA256.new(password.encode()).digest()
cipher = AES.new(key, AES.MODE_CBC, iv=iv)
plain = unpad(cipher.decrypt(hash), AES.block_size)
print(plain)
```
![2](/assets/img/hamac/2.png)

> `FCSC{5bb0780f8af31f69b4eccf18870f493628f135045add3036f35a4e3a423976d6}`.
